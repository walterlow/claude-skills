/**
 * TransitionSlide Component Template
 *
 * Smooth transitions between content sections.
 * Duration: 30 frames (1 second at 30fps)
 *
 * Transition types:
 * - fade: Simple cross-fade
 * - slide: Horizontal slide
 * - scale: Scale with fade
 * - wipe: Diagonal wipe effect
 */

import React, { useState } from "react";
import {
  AbsoluteFill,
  interpolate,
  spring,
  useCurrentFrame,
  useVideoConfig,
  random,
} from "remotion";

type TransitionType = "fade" | "slide" | "scale" | "wipe";

interface TransitionSlideProps {
  transitionType?: TransitionType;
  primaryColor: string;
  secondaryColor: string;
  backgroundColor?: string;
}

export const TransitionSlide: React.FC<TransitionSlideProps> = ({
  transitionType = "fade",
  primaryColor,
  secondaryColor,
  backgroundColor = "#1E293B",
}) => {
  const frame = useCurrentFrame();
  const { fps, width, height } = useVideoConfig();
  const [gradientId] = useState(() => String(random(null)));

  // Progress through transition (0 to 1)
  const progress = spring({
    frame,
    fps,
    config: { damping: 100, mass: 0.8 },
  });

  // Fade transition
  if (transitionType === "fade") {
    const opacity = interpolate(
      frame,
      [0, 15, 15, 30],
      [1, 0.3, 0.3, 1],
      { extrapolateLeft: "clamp", extrapolateRight: "clamp" }
    );

    return (
      <AbsoluteFill style={{ backgroundColor, opacity }}>
        <AbsoluteFill
          style={{
            justifyContent: "center",
            alignItems: "center",
          }}
        >
          {/* Animated gradient circle */}
          <svg
            viewBox={`0 0 200 200`}
            style={{
              width: 100,
              height: 100,
              opacity: interpolate(frame, [0, 15, 15, 30], [0, 1, 1, 0]),
            }}
          >
            <defs>
              <linearGradient id={gradientId} x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stopColor={primaryColor} />
                <stop offset="100%" stopColor={secondaryColor} />
              </linearGradient>
            </defs>
            <circle
              cx={100}
              cy={100}
              r={interpolate(progress, [0, 1], [20, 50])}
              fill={`url(#${gradientId})`}
            />
          </svg>
        </AbsoluteFill>
      </AbsoluteFill>
    );
  }

  // Slide transition
  if (transitionType === "slide") {
    const slideX = interpolate(progress, [0, 1], [-width, 0]);

    return (
      <AbsoluteFill style={{ backgroundColor }}>
        <AbsoluteFill
          style={{
            transform: `translateX(${slideX}px)`,
          }}
        >
          <svg viewBox={`0 0 ${width} ${height}`} style={{ width: "100%", height: "100%" }}>
            <defs>
              <linearGradient id={gradientId} x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stopColor={primaryColor} stopOpacity={0.3} />
                <stop offset="100%" stopColor={secondaryColor} stopOpacity={0.1} />
              </linearGradient>
            </defs>
            <rect fill={`url(#${gradientId})`} width={width} height={height} />
          </svg>
        </AbsoluteFill>
      </AbsoluteFill>
    );
  }

  // Scale transition
  if (transitionType === "scale") {
    const scale = interpolate(progress, [0, 0.5, 1], [1, 1.1, 1]);
    const opacity = interpolate(
      frame,
      [0, 10, 20, 30],
      [1, 0.5, 0.5, 1],
      { extrapolateLeft: "clamp", extrapolateRight: "clamp" }
    );

    return (
      <AbsoluteFill style={{ backgroundColor, opacity }}>
        <AbsoluteFill
          style={{
            transform: `scale(${scale})`,
            justifyContent: "center",
            alignItems: "center",
          }}
        >
          {/* Pulsing ring */}
          <svg viewBox="0 0 200 200" style={{ width: 150, height: 150 }}>
            <defs>
              <linearGradient id={gradientId} x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stopColor={primaryColor} />
                <stop offset="100%" stopColor={secondaryColor} />
              </linearGradient>
            </defs>
            <circle
              cx={100}
              cy={100}
              r={60}
              fill="none"
              stroke={`url(#${gradientId})`}
              strokeWidth={4}
              strokeDasharray={377}
              strokeDashoffset={interpolate(progress, [0, 1], [377, 0])}
              strokeLinecap="round"
            />
          </svg>
        </AbsoluteFill>
      </AbsoluteFill>
    );
  }

  // Wipe transition (diagonal)
  if (transitionType === "wipe") {
    const wipeProgress = interpolate(progress, [0, 1], [-100, 200]);

    return (
      <AbsoluteFill style={{ backgroundColor }}>
        <AbsoluteFill
          style={{
            background: `linear-gradient(135deg,
              ${primaryColor}30 0%,
              ${secondaryColor}30 ${wipeProgress}%,
              transparent ${wipeProgress + 20}%
            )`,
          }}
        />
        {/* Center dot */}
        <AbsoluteFill
          style={{
            justifyContent: "center",
            alignItems: "center",
          }}
        >
          <div
            style={{
              width: interpolate(progress, [0, 0.5, 1], [0, 20, 0]),
              height: interpolate(progress, [0, 0.5, 1], [0, 20, 0]),
              borderRadius: "50%",
              background: `linear-gradient(135deg, ${primaryColor}, ${secondaryColor})`,
            }}
          />
        </AbsoluteFill>
      </AbsoluteFill>
    );
  }

  // Default fallback
  return <AbsoluteFill style={{ backgroundColor }} />;
};

export default TransitionSlide;
